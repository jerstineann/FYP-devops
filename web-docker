FROM ubuntu:18.04

RUN apt-get update && apt-get install -y git
RUN apt-get install -y net-tools
RUN apt-get install -y libterm-readline-gnu-perl

RUN mkdir -p /root/opt/lampp
COPY xampp-linux-x64-8.2.4-0-installer.run /root/opt/xampp-installer.run
RUN chmod +x /root/opt/xampp-installer.run
RUN /root/opt/xampp-installer.run

WORKDIR /opt/lampp/etc/extra
RUN sed -i '/<Directory "\/opt\/lampp\/phpmyadmin">/,/<\/Directory>/d' httpd-xampp.conf

# Modify httpd-xampp.conf
RUN sed -i '/# since XAMPP 1.4.3/ a \
<Directory "/opt/lampp/phpmyadmin">\n\
AllowOverride AuthConfig Limit\n\
Order allow,deny\n\
Require all granted\n\
Allow from all\n\
ErrorDocument 403 /error/XAMPP_FORBIDDEN.html.var\n\
</Directory>' httpd-xampp.conf

WORKDIR /opt/lampp/htdocs/sbc
COPY SBCW /opt/lampp/htdocs/sbc

WORKDIR /
COPY ibdata1 /opt/lampp/var/mysql/
COPY ib_logfile1 /opt/lampp/var/mysql/
COPY ib_logfile0 /opt/lampp/var/mysql/
COPY ib_buffer_pool /opt/lampp/var/mysql/
COPY ibtmp1 /opt/lampp/var/mysql/
RUN chown -R mysql:mysql /opt/lampp/var/mysql/

COPY sbc/. /opt/lampp/var/mysql/sbc/
RUN chmod -R 777 /opt/lampp/var/mysql/sbc/

COPY start_services.sh /start_services.sh
RUN chmod +x /start_services.sh
ENTRYPOINT ["/bin/bash", "/start_services.sh"]
